pts1[i,"filt"]="suspeito"
}
if((pts1$municipality==pts1$NOMEMUNICP)[i]==FALSE){
pts1[i,"filt"]="suspeito"
}
}
pts1
pts1$filt="Ok"
for(i in 1:dim(pts1)[1]){
if(is.na(pts1$municipality==pts1$NOMEMUNICP)[i]==TRUE){
pts1[i,"filt"]="suspeito"
pts1[i,"NOMEMUNICP"]="Fora do Brasil"
pts1[i,"NOMEUF"]="Fora do Brasil"
}
}
for(i in 1:dim(pts1)[1]){
if((pts1$municipality==pts1$NOMEMUNICP)[i]==FALSE){
pts1[i,"filt"]="suspeito"
}
}
pts1
source('~/GitHub/filtros/filt_municip.R', echo=TRUE)
micomira=gbif("Miconia", "mirabilis")
pts=manimax[,c("species","lon","lat","municipality", "adm1")]
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts=na.exclude(pts)
teste=filt_municip(pts1)
pts1
pts1=na.exclude(pts)
teste=filt_municip(pts1)
head(teste)
pts1
pts=teste
pts1=pts[pts$filt=="suspeito",]
pts1
head(pts1)
pts1
coordinates(pts1)=lat~lon
coordinates(pts1)=~lat+lon
head(pts1)
class(pts1)
str(pts)
source('~/GitHub/filtros/filt_municip.R', echo=TRUE)
micomira=gbif("Miconia", "mirabilis")
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts=na.exclude(pts)
pts1=na.exclude(pts)
teste=filt_municip(pts1)
head(teste)
class(teste)
str(teste)
pts=teste
pts1=pts[pts$filt=="suspeito",]
head(pts1)
pts1
coordinates(pts1)=~lat+lon
pts1
pts1=as.data.frame(pts1)
pts1
pts=teste
pts1=pts[pts$filt=="suspeito",]
head(pts1)
pts1
head(pts1)
coordinates(pts1)<- ~lat+lon
pts=teste
pts=pts[pts$filt=="suspeito",]
pts=teste
pts=pts[pts$filt=="suspeito",]
coordinates(pts)<- ~lat+lon
pts1=as.data.frame(pts)
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
br_mun <- spTransform(br_mun, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
proj4string(pts) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts1=cbind(pts1,muni_shape)
pts1[,4]=as.vector(pts1[,4])
pts1[,5]=as.vector(pts1[,5])
for(i in 4:dim(pts1)[2]){
pts1[,i]=tolower(pts1[,i])
pts1[,i]=tolower(pts1[,i])
}
pts1
(pts1$municipality==pts1$NOMEMUNICP)[i]==FALSE
(pts1$municipality==pts1$NOMEMUNICP)
names(pts1)
pts1$municipality==pts1[,9]
for(i in 1:dim(pts1)[1]){
if(is.na(pts1$municipality==pts1[,9])[i]==TRUE){
pts1[i,"filt"]="suspeito"
}
}
for(i in 1:dim(pts1)[1]){
if(is.na(pts1$municipality==pts1[,9])[i]==TRUE){
pts1[i,"filt"]="suspeito"
pts1[i,9]="Fora do Brasil"
pts1[i,9]="Fora do Brasil"
}
}
(pts1$municipality==pts1[,9])[i]==FALSE
pts1[,9]
pts1$municipality
source('~/GitHub/filtros/coord_invertida.R', echo=TRUE)
teste2=invert(teste)
teste2
source('~/GitHub/filtros/coord_invertida.R', echo=TRUE)
teste2=invert(teste)
teste2
manimax=gbif("Manilkara", "maxima")
pts=manimax[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste=filt_municip(pts1)
head(teste)
teste2=invert(teste)
teste2
source("https://raw.githubusercontent.com/diogosbr/filtros/master/coord_invertida.R")
invert
source("https://raw.githubusercontent.com/diogosbr/filtros/master/filt_municip.R")
source("https://raw.githubusercontent.com/diogosbr/filtros/master/coord_invertida.R")
micomira=gbif("Miconia", "mirabilis")
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
require(dismo)
micomira=gbif("Miconia", "mirabilis")
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
source("https://raw.githubusercontent.com/diogosbr/filtros/master/filt_municip.R")
source("https://raw.githubusercontent.com/diogosbr/filtros/master/coord_invertida.R")
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste=filt_municip(pts1)
head(teste)
teste2=invert(teste)
head(teste2)
micomira=gbif("Miconia", "mirabilis")
#especie, lon, lat, municipio
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
micomira=dismo::gbif("Miconia", "mirabilis")
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
aaa=pts1
pts=aaa
pts=na.exclude(pts)
coordinates(pts)<- ~lon+lat
if(missing(shape.municipios)){
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
} else(br_mun=shape.municipios)
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
require(rgdal)
require(raster)
require(dismo)
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
br_mun <- spTransform(br_mun, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
proj4string(pts) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
pts1=as.data.frame(pts)
muni_shape=over(pts,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts1=cbind(pts1,muni_shape)
pts1[,4]=as.vector(pts1[,4])
pts1[,5]=as.vector(pts1[,5])
require(maptools)
muni_shape=over(pts,br_mun)[,c('NOMEMUNICP','NOMEUF')]
br_mun <- spTransform(br_mun, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
proj4string(pts) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
coordinates(pts)<- ~lon+lat
br_mun <- spTransform(br_mun, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
proj4string(pts) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
pts1=as.data.frame(pts)
muni_shape=over(pts,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts1=cbind(pts1,muni_shape)
pts1[,4]=as.vector(pts1[,4])
pts1[,5]=as.vector(pts1[,5])
for(i in 4:dim(pts1)[2]){
pts1[,i]=tolower(pts1[,i])
pts1[,i]=tolower(pts1[,i])
}
rm_accent <- function(str,pattern="all") {
# Rotinas e funções úteis V 1.0
# rm.accent - REMOVE ACENTOS DE PALAVRAS
# Função que tira todos os acentos e pontuações de um vetor de strings.
# Parâmetros:
# str - vetor de strings que terão seus acentos retirados.
# patterns - vetor de strings com um ou mais elementos indicando quais acentos deverão ser retirados.
#            Para indicar quais acentos deverão ser retirados, um vetor com os símbolos deverão ser passados.
#            Exemplo: pattern = c("´", "^") retirará os acentos agudos e circunflexos apenas.
#            Outras palavras aceitas: "all" (retira todos os acentos, que são "´", "`", "^", "~", "¨", "ç")
if(!is.character(str))
str <- as.character(str)
pattern <- unique(pattern)
if(any(pattern=="Ç"))
pattern[pattern=="Ç"] <- "ç"
symbols <- c(
acute = "áéíóúÁÉÍÓÚýÝ",
grave = "àèìòùÀÈÌÒÙ",
circunflex = "âêîôûÂÊÎÔÛ",
tilde = "ãõÃÕñÑ",
umlaut = "äëïöüÄËÏÖÜÿ",
cedil = "çÇ"
)
nudeSymbols <- c(
acute = "aeiouAEIOUyY",
grave = "aeiouAEIOU",
circunflex = "aeiouAEIOU",
tilde = "aoAOnN",
umlaut = "aeiouAEIOUy",
cedil = "cC"
)
accentTypes <- c("´","`","^","~","¨","ç")
if(any(c("all","al","a","todos","t","to","tod","todo")%in%pattern)) # opcao retirar todos
return(chartr(paste(symbols, collapse=""), paste(nudeSymbols, collapse=""), str))
for(i in which(accentTypes%in%pattern))
str <- chartr(symbols[i],nudeSymbols[i], str)
return(str)
}
pts1$municipality=rm_accent(pts1$municipality)
pts1$filt="Ok"
for(i in 1:dim(pts1)[1]){
if(is.na(pts1$municipality==pts1$NOMEMUNICP)[i]==TRUE){
pts1[i,"filt"]="suspeito"
pts1[i,"NOMEMUNICP"]="Fora do Brasil"
pts1[i,"NOMEUF"]="Fora do Brasil"
}
}
for(i in 1:dim(pts1)[1]){
if((pts1$municipality==pts1$NOMEMUNICP)[i]==FALSE){
pts1[i,"filt"]="suspeito"
}
}
pts1
pts2=pts1[pts1$filt=="suspeito",]
coordinates(pts2)<- ~lat+lon
pts3=as.data.frame(pts2)
proj4string(pts2) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts2,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts3=cbind(pts3,muni_shape)
pts3[,4]=as.vector(pts3[,4])
pts3[,5]=as.vector(pts3[,5])
for(i in 4:dim(pts1)[2]){
pts3[,i]=tolower(pts3[,i])
pts3[,i]=tolower(pts3[,i])
}
for(i in 1:dim(pts3)[1]){
if(is.na(pts3$municipality==pts3[,9])[i]==TRUE){
pts3[i,"filt"]="suspeito"
pts3[i,9]="Fora do Brasil"
pts3[i,10]="Fora do Brasil"
}
}
for(i in 1:dim(pts3)[1]){
if((pts3$municipality==pts3[,9])[i]==TRUE){
pts3[i,"filt"]="Invertidas"
}
}
pts3
source('~/GitHub/filtros/completo.R', echo=TRUE)
source('~/GitHub/filtros/completo.R', echo=TRUE)
micomira=gbif("Miconia", "mirabilis")
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
teste3=filt(pts1)
teste3
pts1=na.exclude(pts)
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste3=filt(pts1)
teste3
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
names(pts1)
teste3=filt(pts1)
teste3
pts1
coordinates(pts)<- ~lon+lat
coordinates(pts1)<- ~lon+lat
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
proj4string(pts1) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
pts2=as.data.frame(pts1)
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts2=cbind(pts2,muni_shape)
pts2[,4]=as.vector(pts2[,4])
pts2[,5]=as.vector(pts2[,5])
pts2
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
coordinates(pts1)<- ~lat+lon
pts1
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
proj4string(pts1) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
pts1
coordinates(pts1)<- ~lat+lon
pts2=as.data.frame(pts1)
proj4string(pts1) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
br_mun
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape
source('~/GitHub/filtros/completo.R', echo=TRUE)
manimax=gbif("Manilkara", "maxima")
pts=manimax[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste3=filt(pts1)
teste3
manimax=gbif("Manilkara", "maxima")
pts=manimax[,c("species","lon","lat","municipality", "adm1")]
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
coordinates(pts1)<- ~lat+lon
pts2=as.data.frame(pts1)
proj4string(pts1) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts2=cbind(pts2,muni_shape)
pts2[,4]=as.vector(pts2[,4])
pts2[,5]=as.vector(pts2[,5])
pts2
for(i in 4:dim(pts2)[2]){
pts2[,i]=tolower(pts2[,i])
pts2[,i]=tolower(pts2[,i])
}
pts2
for(i in 1:dim(pts2)[1]){
if(is.na(pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="suspeito"
pts2[i,9]="Fora do Brasil"
pts2[i,10]="Fora do Brasil"
}
}
pts2
pts1$filt="Ok"
for(i in 4:dim(pts2)[2]){
pts2[,i]=tolower(pts2[,i])
pts2[,i]=tolower(pts2[,i])
}
for(i in 1:dim(pts2)[1]){
if(is.na(pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="suspeito"
pts2[i,9]="Fora do Brasil"
pts2[i,10]="Fora do Brasil"
}
}
for(i in 1:dim(pts2)[1]){
if((pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="Invertidas"
}
}
pts2
pts2$filt="Ok"
for(i in 4:dim(pts2)[2]){
pts2[,i]=tolower(pts2[,i])
pts2[,i]=tolower(pts2[,i])
}
for(i in 1:dim(pts2)[1]){
if(is.na(pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="suspeito"
pts2[i,9]="Fora do Brasil"
pts2[i,10]="Fora do Brasil"
}
}
pts2
manimax=gbif("Manilkara", "maxima")
#especie, lon, lat, municipio
pts=manimax[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
pts=na.exclude(pts)
pts=pts1
pts=na.exclude(pts)
coordinates(pts)<- ~lon+lat
if(missing(shape.municipios)){
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
} else(br_mun=shape.municipios)
br_mun=readOGR("./Shapes/brasil_mun_ibge/brasil_mun_ibge.shp")
br_mun <- spTransform(br_mun, CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"))
proj4string(pts) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
pts1=as.data.frame(pts)
muni_shape=over(pts,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts1=cbind(pts1,muni_shape)
pts1[,4]=as.vector(pts1[,4])
pts1[,5]=as.vector(pts1[,5])
for(i in 4:dim(pts1)[2]){
pts1[,i]=tolower(pts1[,i])
pts1[,i]=tolower(pts1[,i])
}
rm_accent <- function(str,pattern="all") {
# Rotinas e funções úteis V 1.0
# rm.accent - REMOVE ACENTOS DE PALAVRAS
# Função que tira todos os acentos e pontuações de um vetor de strings.
# Parâmetros:
# str - vetor de strings que terão seus acentos retirados.
# patterns - vetor de strings com um ou mais elementos indicando quais acentos deverão ser retirados.
#            Para indicar quais acentos deverão ser retirados, um vetor com os símbolos deverão ser passados.
#            Exemplo: pattern = c("´", "^") retirará os acentos agudos e circunflexos apenas.
#            Outras palavras aceitas: "all" (retira todos os acentos, que são "´", "`", "^", "~", "¨", "ç")
if(!is.character(str))
str <- as.character(str)
pattern <- unique(pattern)
if(any(pattern=="Ç"))
pattern[pattern=="Ç"] <- "ç"
symbols <- c(
acute = "áéíóúÁÉÍÓÚýÝ",
grave = "àèìòùÀÈÌÒÙ",
circunflex = "âêîôûÂÊÎÔÛ",
tilde = "ãõÃÕñÑ",
umlaut = "äëïöüÄËÏÖÜÿ",
cedil = "çÇ"
)
nudeSymbols <- c(
acute = "aeiouAEIOUyY",
grave = "aeiouAEIOU",
circunflex = "aeiouAEIOU",
tilde = "aoAOnN",
umlaut = "aeiouAEIOUy",
cedil = "cC"
)
accentTypes <- c("´","`","^","~","¨","ç")
if(any(c("all","al","a","todos","t","to","tod","todo")%in%pattern)) # opcao retirar todos
return(chartr(paste(symbols, collapse=""), paste(nudeSymbols, collapse=""), str))
for(i in which(accentTypes%in%pattern))
str <- chartr(symbols[i],nudeSymbols[i], str)
return(str)
}
pts1$municipality=rm_accent(pts1$municipality)
pts1$filt="Ok"
for(i in 1:dim(pts1)[1]){
if(is.na(pts1$municipality==pts1$NOMEMUNICP)[i]==TRUE){
pts1[i,"filt"]="suspeito"
pts1[i,"NOMEMUNICP"]="Fora do Brasil"
pts1[i,"NOMEUF"]="Fora do Brasil"
}
}
for(i in 1:dim(pts1)[1]){
if((pts1$municipality==pts1$NOMEMUNICP)[i]==FALSE){
pts1[i,"filt"]="suspeito"
}
}
pts1
str(pts1)
coordinates(pts1)<- ~lat+lon
pts2=as.data.frame(pts1)
proj4string(pts1) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
muni_shape=over(pts1,br_mun)[,c('NOMEMUNICP','NOMEUF')]
muni_shape[,1]=as.vector(muni_shape[,1])
muni_shape[,2]=as.vector(muni_shape[,2])
pts2=cbind(pts2,muni_shape)
pts2
pts2[,8]=as.vector(pts2[,8])
pts2[,9]=as.vector(pts2[,9])
for(i in 4:dim(pts2)[2]){
pts2[,i]=tolower(pts2[,i])
pts2[,i]=tolower(pts2[,i])
}
pts2
for(i in 1:dim(pts2)[1]){
if(is.na(pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="suspeito"
pts2[i,9]="Fora do Brasil"
pts2[i,10]="Fora do Brasil"
}
}
pts2
for(i in 1:dim(pts2)[1]){
if((pts2$municipality==pts2[,9])[i]==TRUE){
pts2[i,"filt"]="Invertidas"
}
}
pts2
source('~/GitHub/filtros/completo.R', echo=TRUE)
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste3=filt(pts1)
teste3
source('~/GitHub/filtros/completo.R', echo=TRUE)
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
names(pts1)=c("species"   ,   "lat"     ,     "lon"      ,    "municipality" ,"adm1" )
teste3=filt(pts1)
teste3
pts=micomira[,c("species","lon","lat","municipality", "adm1")]
pts1=na.exclude(pts)
pts1
pts1[1,2]=(-22.959222)
pts1[1,3]=(-43.27772)
pts1
teste3=filt(pts1)
teste3
